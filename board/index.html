<html>
	<head>
		<style>
			body {
            	font-family: Arial, Helvetica, sans-serif;
            	text-align: center;
			}
			
			button {
				display: inline-block;
			}
			
			.card {
				height:85px;
				width:150px;
				border:1px solid black;
				display:inline-block;
				text-align:center;
				line-height:85px;
				border-radius:10px;
				margin-left:10px;
			}
			
			.row {
				margin-top:15px;
			}
			
			.headerContent {
				display: inline-block;
			}
			
			#indicator {
				
			}
			
			#title {
			position:relative;
				margin-left: 0;
			}
			
			#newButton {
			position:relative;
				margin-right: 0;
			}
			
			#score {
				
			}
			
			#modalContainer {
				position:absolute;
				background-color:clear;
				left:0;
				top:0;
				right:0;
				bottom:0;
				display:none;
				justify-content:center;
				align-items:center;
				background-color: rgba(0, 0, 0, 0.4);
				opacity:0;
				transition: opacity .5s;
			}
			
			#modal {
				background-color:white;
				padding:20px;
				border-radius: 20px;
			}
			
			#qrOut {
				width:100%;
			}
			img {
				margin-left:auto;
				margin-right:auto;
			}
			
		</style>
		<script type="text/javascript" src="wordList.js"></script>
		<script type="text/javascript" src="qrcode.js"></script>
		<script>
			//0=neutral, 1=red, 2=blue, 3=assassin
			var numArr = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
			var gameWords = ["","","","","","","","","","","","","","","","","","","","","","","","",""];
			var turn = false;
			var redLeft; var blueLeft;
			var gameStarted = false;
			
			function displayModal() {
				document.getElementById('modalContainer').style.display = 'flex';
				document.getElementById('modalContainer').style.opacity = 1;
			}
			
			function generateQR() {
				var inputStr = "https://www.jwhamilton.co/spyalias/key?input=";
				for(var i = 0; i < numArr.length; i++) {
					inputStr+=numArr[i];
				}
				
				console.log(inputStr);
				
				for(var i = 0; i < document.getElementById("qrOut").childNodes.length; i++) {
					document.getElementById("qrOut").removeChild(document.getElementById("qrOut").childNodes[i]);
				}
				
				var options = {
					text: inputStr,
					width: 256,
					height: 256,
					colorDark: "#000000",
					colorLight: "#ffffff",
					correctLevel: QRCode.CorrectLevel.H
				}

				// generates QR Code in the DOM element
				var my_qr_code = new QRCode(document.getElementById("qrOut"), options);
				displayModal();
			}
			
			function generateBoard() {
				var cards = document.getElementsByClassName("card");
				for(var i = 0; i < cards.length; i++) {
					cards[i].style.color = "black";
					cards[i].style.backgroundColor = "white";
				}
				numArr = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
				turn = (Math.floor(Math.random()*2)+1 == 1);
				//assassin
				numArr[Math.floor(Math.random()*24)] = 3;
				
				for(var i = 0; i < 9; i++) {
					var index = Math.floor(Math.random()*24);
					while(numArr[index] != 0) {
						index = Math.floor(Math.random()*24);
					}
					numArr[index] = (turn)?1:2;
				}
				
				for(var i = 0; i < 8; i++) {
					var index = Math.floor(Math.random()*24);
					while(numArr[index] != 0) {
						index = Math.floor(Math.random()*24);
					}
					numArr[index] = (turn)?2:1;
				}
				
				if(turn) {
					redLeft = 9;
					blueLeft = 8;
				} else {
					redLeft = 8;
					blueLeft = 9;
				}
				
				for(var i = 0; i < numArr.length; i++) {
					var currWord = wordList[Math.floor(Math.random()*wordList.length)];
					var flag = true;
					while(flag) {
						flag = false;
						for(var w in wordList) {
							if(w == currWord) {
								currWord = wordList[Math.floor(Math.random()*wordList.length)];
								flag = true;
							}
						}
					}
					cards[i].innerHTML = currWord;
				}
				
				document.getElementById("indicator").innerHTML = (((turn)?"Red":"Blue")+"'s Turn");
				document.getElementById("score").innerHTML = ("Red: "+redLeft+", Blue: "+blueLeft);
				
				gameStarted = true;
				
				generateQR();
			}
			
			function revealCard(index) {
				if(gameStarted) {
					var cards = document.getElementsByClassName("card");
					switch(numArr[index]) {
					case 1:
						cards[index].style.backgroundColor = "red";
						cards[index].style.color = "red";
						redLeft--;
						break;
					case 2:
						cards[index].style.backgroundColor = "blue";
						cards[index].style.color = "blue";
						blueLeft--;
						break;
					case 3:
						cards[index].style.backgroundColor = "black";
						cards[index].style.color = "black";
						gameStarted = false;
						document.getElementById("indicator").innerHTML = (((turn)?"Red":"Blue")+" Wins!");
						break;
					default:
						cards[index].style.backgroundColor = "gray";
						cards[index].style.color = "gray";
						break;
					}
				
					if(gameStarted) {
						if(blueLeft <= 0 || redLeft <= 0) {
							gameStarted = false;
							if(blueLeft <= 0) {
								document.getElementById("indicator").innerHTML = ("Blue Wins!");
							} else {
								document.getElementById("indicator").innerHTML = ("Red Wins!");
							}
						} else {
							turn = !turn;
							document.getElementById("indicator").innerHTML = (((turn)?"Red":"Blue")+"'s Turn");
							document.getElementById("score").innerHTML = ("Red: "+redLeft+", Blue: "+blueLeft);
						}
					}
				}
			}
		</script>
	</head>
	<body>
		<div id="header">
			<div class="headerContent" id="title">
				<h1>SpyAlias</h1>
			</div>
			<div class="headerContent" id="indicator"></div>
			<div class="headerContent" id="newButton">
				<button onclick="generateBoard()">New Board</button>
			</div>
		</div>
		<div id="cards">
			<div id="row1" class="row">
				<div class="card" onclick="revealCard(0)"></div>
				<div class="card" onclick="revealCard(1)"></div>
				<div class="card" onclick="revealCard(2)"></div>
				<div class="card" onclick="revealCard(3)"></div>
				<div class="card" onclick="revealCard(4)"></div>
			</div>
			<div id="row2" class="row">
				<div class="card" onclick="revealCard(5)"></div>
				<div class="card" onclick="revealCard(6)"></div>
				<div class="card" onclick="revealCard(7)"></div>
				<div class="card" onclick="revealCard(8)"></div>
				<div class="card" onclick="revealCard(9)"></div>
			</div>
			<div id="row3" class="row">
				<div class="card" onclick="revealCard(10)"></div>
				<div class="card" onclick="revealCard(11)"></div>
				<div class="card" onclick="revealCard(12)"></div>
				<div class="card" onclick="revealCard(13)"></div>
				<div class="card" onclick="revealCard(14)"></div>
			</div>
			<div id="row4" class="row">
				<div class="card" onclick="revealCard(15)"></div>
				<div class="card" onclick="revealCard(16)"></div>
				<div class="card" onclick="revealCard(17)"></div>
				<div class="card" onclick="revealCard(18)"></div>
				<div class="card" onclick="revealCard(19)"></div>
			</div>
			<div id="row5" class="row">
				<div class="card" onclick="revealCard(20)"></div>
				<div class="card" onclick="revealCard(21)"></div>
				<div class="card" onclick="revealCard(22)"></div>
				<div class="card" onclick="revealCard(23)"></div>
				<div class="card" onclick="revealCard(24)"></div>
			</div>
		</div>
		<div id="score"></div>
		
		<div id="modalContainer">
			<div id="modal">
				<h1>Scan on your phone:</h1>
				<div id="qrOut"></div><br>
				<button onclick="document.getElementById('modalContainer').style.display = 'none'">Dismiss</button>
			</div>			
		</div>
	</body>
</html>